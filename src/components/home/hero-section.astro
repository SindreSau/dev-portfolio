---
import AvailableBadge from "@/components/home/available-badge.astro";
import IconCity from "@components/icons/icon-city.astro";
import DesktopParallaxIcons from "./desktop-parallax-icons.astro";
import MobileTechIcons from "./mobile-tech-icons.astro";

const AVAILABLE_FOR_WORK = import.meta.env.PUBLIC_AVAILABLE_FOR_WORK === "true";
console.log("Available for work badge is set to: ", AVAILABLE_FOR_WORK);
---

<section
    id="hero-section"
    class="w-full h-[calc(100vh-4rem)] md:overflow-hidden pointer-events-none"
>
    <div
        class="md:absolute md:top-1/2 md:left-1/2 md:-translate-x-1/2 md:-translate-y-1/2 text-left z-10 md:w-2/3 lg:w-1/2 max-w-4xl pointer-events-none"
    >
        <div class="md:hidden">
            <div
                class="translate-y-15 scale-75 translate-x-[210px] w-fit opacity-80"
                id="hero-avilable-badge-mobile"
            >
                {AVAILABLE_FOR_WORK && <AvailableBadge />}
            </div>
        </div>

        <div class="hidden md:block">
            <div
                class="md:-translate-x-5 md:translate-y-1 md:scale-100 translate-x-[210px] w-fit opacity-80"
                id="hero-avilable-badge-desktop"
            >
                {AVAILABLE_FOR_WORK && <AvailableBadge />}
            </div>
        </div>

        <h1 class="flex flex-col md:text-5xl text-3xl md:gap-0 gap-2">
            <span class="">Hi, I'm </span>
            <span
                id="animated-heading"
                class="xl:text-7xl text-nowrap md:text-5xl bg-gradient-to-r text-primary-muted dark:brightness-125 brightness-75 bg-clip-text uppercase md:tracking-wider font-expletus pointer-events-auto"
                >Sindre Sauarlia</span
            >
        </h1>
        <p class="mt-4 text-lg pointer-events-auto md:text-justify">
            I'm a full-stack developer dedicated to deeply understand every
            aspect of the software development process.

            <span class="text-primary-muted flex gap-2 items-center mt-1">
                <IconCity class="size-5" />
                Oslo, Norway
            </span>
        </p>
    </div>

    <!-- Desktop parallax effect component -->
    <DesktopParallaxIcons />

    <!-- Mobile tech icons component -->
    <MobileTechIcons />

    <script>
        import { gsap } from "gsap";
        import { SplitText } from "gsap/SplitText";
        import { ScrollTrigger } from "gsap/ScrollTrigger";

        function initializeHeroAnimations() {
            if (typeof gsap === "undefined") {
                console.warn("GSAP is not defined. Make sure it is loaded.");
                return;
            }

            // Register GSAP plugins
            gsap.registerPlugin(SplitText, ScrollTrigger);

            const heroSection = document.getElementById("hero-section");
            const animatedHeading = document.getElementById("animated-heading");

            if (!heroSection || !animatedHeading) {
                console.warn("Hero section elements not found");
                return;
            }

            // Fade in the hero section
            gsap.fromTo(
                heroSection,
                { opacity: 0 },
                { opacity: 1, duration: 1.25, delay: 0.4 }
            );

            const badgeMobile = document.getElementById(
                "hero-avilable-badge-mobile"
            );
            if (badgeMobile) {
                gsap.fromTo(
                    badgeMobile,
                    { opacity: 0, translateY: 40 },
                    { opacity: 1, translateY: 60, duration: 0.6, delay: 1.8 }
                );
            }

            // Ensure fonts are loaded before using SplitText
            document.fonts.ready.then(() => {
                // Create split text instance only if the element exists
                if (animatedHeading) {
                    try {
                        const splitText = new SplitText(animatedHeading, {
                            type: "chars",
                            position: "relative",
                        });

                        // Store the timeline for later use
                        let hoverTimeline = gsap.timeline();

                        // Animate each character
                        hoverTimeline.to(splitText.chars, {
                            y: 9,
                            scale: 1.2,
                            color: "var(--color-primary, #4f46e5)",
                            stagger: 0.025,
                            duration: 0.5,
                            ease: "power3.inOut",
                            delay: 1,
                        });
                    } catch (error) {
                        console.warn("Error with SplitText animation:", error);
                    }
                }
            });
        }

        // Run on initial load and when navigating pages
        document.addEventListener("astro:page-load", initializeHeroAnimations);

        // Also initialize if page is already loaded (for view transitions)
        if (document.readyState === "complete") {
            initializeHeroAnimations();
        }
    </script>
</section>
