---
import { Icon } from "astro-icon/components";
import { techData } from "./tech-data";

const iconsPerRow = 3;
const items = techData.sort(() => Math.random() - 0.5); // Show all tech icons in random order
---

<div
    class="absolute bottom-0 bg-red left-0 w-full h-5/6 pointer-events-none"
    id="mobile-tech-icons-container"
>
    <div
        class="flex flex-nowrap justify-center items-center w-full h-full transition-transform duration-1000"
        id="mobile-tech-icons-wrapper"
    >
        {
            items.map((tech, index) => (
                <div
                    class="m-4 transform-gpu"
                    style={{
                        "--delay": `${index * 0.2}s`,
                        "--scale-start": "0.8",
                        "--opacity-start": "0",
                    }.toString()}
                >
                    <Icon
                        name={`${tech.iconifyPkg}:${tech.iconifyIcon}`}
                        class="text-primary-muted transition-all duration-1000"
                        style={`width: ${tech.size === "lg" ? "48px" : "32px"}; height: ${tech.size === "lg" ? "48px" : "32px"}`}
                    />
                </div>
            ))
        }
    </div>
</div>

<script>
    import { gsap } from "gsap";
    import { ScrollTrigger } from "gsap/ScrollTrigger";
    gsap.registerPlugin(ScrollTrigger);

    document.addEventListener("astro:page-load", () => {
        const container = document.getElementById(
            "mobile-tech-icons-container"
        );
        const wrapper = document.getElementById("mobile-tech-icons-wrapper");
        const icons = document.querySelectorAll<HTMLDivElement>(
            "#mobile-tech-icons-wrapper > div"
        );

        if (!container || !icons.length || !wrapper) return;

        // Create a looping carousel effect
        gsap.to(wrapper, {
            xPercent: -100,
            ease: "none",
            duration: 20,
            repeat: -1,
            modifiers: {
                xPercent: gsap.utils.wrap(-100, 0),
            },
        });

        // Add bounce effect on scroll
        gsap.to(wrapper, {
            y: -20,
            ease: "power2.out",
            duration: 1.5,
            repeat: -1,
            yoyo: true,
            paused: true,
            scrollTrigger: {
                trigger: container,
                start: "top 60%",
                end: "bottom 40%",
                scrub: 0.5,
            },
        });

        // Animate icons on initial load
        gsap.fromTo(
            icons,
            {
                opacity: 0,
                scale: 0.8,
                y: 200,
                ease: "power3.out",
            },
            {
                opacity: 1,
                scale: 1,
                y: 0,
                stagger: 0.15,
                duration: 1.2,
                scrollTrigger: {
                    trigger: container,
                    start: "top 80%",
                    end: "bottom 20%",
                    scrub: true,
                    toggleActions: "play none none reverse",
                },
            }
        );
    });
</script>
